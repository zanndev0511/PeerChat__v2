var e=Object.defineProperty,s=("undefined"!=typeof require&&require,(s,r,t)=>(((s,r,t)=>{r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t})(s,"symbol"!=typeof r?r+"":r,t),t));class r{constructor(e,r){s(this,"_value"),s(this,"_beforeDestroys"),s(this,"_subscribers"),this._value=e,r&&(this.compare=r)}get value(){return this._value}setValue(e,s){if(!this.compare(e,this._value)){const r=this._value;this._value=e,this._subscribers&&this._subscribers.forEach((t=>t(e,r,s)))}}reaction(e){return this._subscribers||(this._subscribers=new Set),this._subscribers.add(e),()=>{this._subscribers&&this._subscribers.delete(e)}}subscribe(e,s){const r=this.reaction(e);return e(this._value,void 0,s),r}derive(e,s,t){const i=new r(e(this.value,void 0,t),s),o=this.reaction(((s,r,t)=>{i.setValue(e(s,r,t))}));return i.addBeforeDestroy(o),i}destroy(){this._beforeDestroys&&(this._beforeDestroys.forEach((e=>e())),this._beforeDestroys.clear()),this._subscribers&&this._subscribers.clear()}addBeforeDestroy(e){return this._beforeDestroys||(this._beforeDestroys=new Set),this._beforeDestroys.add(e),()=>{this._beforeDestroys&&this._beforeDestroys.delete(e)}}compare(e,s){return e===s}}function t(e,s,t,i){let o=e.map((e=>e.value));const u=new r(s(o,void 0,i),t);return e.forEach(((e,r)=>{const t=e.reaction(((e,t,i)=>{const c=o.slice();c[r]=e;const n=o;o=c,u.setValue(s(c,n,i),i)}));u.addBeforeDestroy(t)})),u}function i(e,s){Object.keys(s).forEach((r=>{u(e,r,s[r])}))}function o(e){return(s,r)=>(u(e,s,r),r)}function u(e,s,r){var t;return Object.defineProperties(e,{[s]:{get:()=>r.value},[`_${s}$`]:{value:r},[`set${t=s,t[0].toUpperCase()+t.slice(1)}`]:{value:(e,s)=>r.setValue(e,s)}}),e}function c(e){const s=s=>{const r=e.addDisposer((()=>{s.destroy()}));return s.addBeforeDestroy((()=>{e.remove(r)})),s};return{bindSideEffect:s,combine:(e,r,i,o)=>s(t(e,r,i,o)),createVal:(e,t)=>s(new r(e,t))}}export{r as Val,u as bindInstance,t as combine,o as createInstanceBinder,c as createSideEffectBinder,i as withValueEnhancer};
//# sourceMappingURL=value-enhancer.es.js.map
