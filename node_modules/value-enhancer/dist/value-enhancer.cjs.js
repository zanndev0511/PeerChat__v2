"use strict";var z=Object.defineProperty,$=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var l=(r,e,s)=>e in r?z(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,_=(r,e)=>{for(var s in e||(e={}))O.call(e,s)&&l(r,s,e[s]);if(V)for(var s of V(e))j.call(e,s)&&l(r,s,e[s]);return r},d=(r,e)=>$(r,C(e));var u=(r,e,s)=>(l(r,typeof e!="symbol"?e+"":e,s),s);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});class y{constructor(e){u(this,"_subscribers");u(this,"_bSub");u(this,"_bSubDisposer");this._bSub=e}get size(){return this._subscribers?this._subscribers.size:0}invoke(e,s){this._subscribers&&this._subscribers.forEach(i=>i(e,s))}add(e){this._bSub&&(!this._subscribers||this._subscribers.size<=0)&&(this._bSubDisposer=this._bSub()),this._subscribers||(this._subscribers=new Set),this._subscribers.add(e)}remove(e){if(this._subscribers&&this._subscribers.delete(e),this._subscribers&&this._subscribers.size<=0&&this._bSubDisposer){const s=this._bSubDisposer;this._bSubDisposer=null,s()}}clear(){if(this._subscribers&&this._subscribers.clear(),this._bSubDisposer){const e=this._bSubDisposer;this._bSubDisposer=null,e()}}destroy(){this.clear()}}class h{constructor(e,s){u(this,"_subscribers");u(this,"_value");this._value=e;let i;if(s&&(s.compare&&(this.compare=s.compare),s.beforeSubscribe)){const t=s.beforeSubscribe,b=this._setValue.bind(this);i=()=>t(b)}this._subscribers=new y(i)}_setValue(e,s){this.compare(e,this._value)||(this._value=e,this._subscribers.invoke(e,s))}get value(){return this._value}reaction(e){return this._subscribers.add(e),()=>{this._subscribers.remove(e)}}subscribe(e,s){const i=this.reaction(e);return e(this._value,s),i}destroy(){this._subscribers.destroy()}unsubscribe(e){this._subscribers.remove(e)}get size(){return this._subscribers.size}compare(e,s){return e===s}}class R extends h{constructor(){super(...arguments);u(this,"setValue",this._setValue)}}class p extends h{constructor(s,i,t={}){super(i(s.value),d(_({},t),{beforeSubscribe:b=>{const c=s.subscribe((a,o)=>b(i(a),o));if(t.beforeSubscribe){const a=t.beforeSubscribe(b);if(a)return()=>{c(),a()}}return c}}));u(this,"_srcValue");this._srcValue=()=>i(s.value)}get value(){if(this.size<=0){const s=this._srcValue();return this.compare(s,this._value)?this._value:s}return this._value}}function g(r,e=i=>i,s={}){return new p(r,e,s)}class S extends h{constructor(s,i,t={}){super(i(f(s)),d(_({},t),{beforeSubscribe:b=>{let c=f(s);b(i(c));const a=s.map((n,m)=>n.reaction((w,E)=>{c=c.slice(),c[m]=w,b(i(c),E)})),o=()=>a.forEach(n=>n());if(t.beforeSubscribe){const n=t.beforeSubscribe(b);if(n)return()=>{o(),n()}}return o}}));u(this,"_srcValue");this._srcValue=()=>i(f(s))}get value(){if(this.size<=0){const s=this._srcValue();return this.compare(s,this._value)?this._value:s}return this._value}}function f(r){return r.map(x)}function x(r){return r.value}function P(r,e=i=>i,s={}){return new S(r,e,s)}function v(r){r.onValChanged||(r.onValChanged=M)}function M(r,e){const s=this[`_${r}$`]||this[r];if(!(s!=null&&s.reaction))throw new TypeError(`"${r}" is not related to a Val in this instance`);return s.reaction(e)}function T(r,e,s){Object.keys(e).forEach(i=>{I(r,i,e[i]),s&&s.attach(e[i])}),v(r)}function I(r,e,s){return Object.defineProperties(r,{[e]:{get(){return s.value}},[`_${e}$`]:{value:s}}),r}function U(r,e,s){Object.keys(e).forEach(i=>{D(r,i,e[i]),s&&s.attach(e[i])}),v(r)}function D(r,e,s){return Object.defineProperties(r,{[e]:{get(){return s.value},set(i){s.setValue(i)}},[`_${e}$`]:{value:s},[`set${q(e)}`]:{value:(i,t)=>s.setValue(i,t)}}),r}function q(r){return r[0].toUpperCase()+r.slice(1)}class A{constructor(){u(this,"vals",new Set)}attach(e){return this.vals.add(e),e}detach(e){return this.vals.delete(e),e}destroy(){this.vals.forEach(B),this.vals.clear()}}function B(r){r.destroy()}exports.CombinedVal=S;exports.DerivedVal=p;exports.ReadonlyVal=h;exports.Val=R;exports.ValManager=A;exports.bindInstance=D;exports.combine=P;exports.derive=g;exports.withReadonlyValueEnhancer=T;exports.withValueEnhancer=U;
//# sourceMappingURL=value-enhancer.cjs.js.map
