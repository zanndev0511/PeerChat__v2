{"version":3,"file":"value-enhancer.es.js","sources":["../src/subscribers.ts","../src/readonly-val.ts","../src/val.ts","../src/derived-val.ts","../src/combine.ts","../src/with-on-val-changed.ts","../src/with-readonly-value-enhancer.ts","../src/with-value-enhancer.ts","../src/val-manager.ts"],"sourcesContent":["import type { ValDisposer, ValSubscriber } from \"./typings\";\n\nexport class Subscribers<TValue = any, TMeta = any> {\n  public get size(): number {\n    return this._subscribers ? this._subscribers.size : 0;\n  }\n\n  public constructor(beforeSubscribe?: () => void | ValDisposer | undefined) {\n    this._bSub = beforeSubscribe;\n  }\n\n  public invoke(newValue: TValue, meta?: TMeta): void {\n    if (this._subscribers) {\n      this._subscribers.forEach(subscriber => subscriber(newValue, meta));\n    }\n  }\n\n  public add(subscribe: ValSubscriber): void {\n    if (this._bSub && (!this._subscribers || this._subscribers.size <= 0)) {\n      this._bSubDisposer = this._bSub();\n    }\n\n    if (!this._subscribers) {\n      this._subscribers = new Set();\n    }\n\n    this._subscribers.add(subscribe);\n  }\n\n  public remove(subscriber: ValSubscriber): void {\n    if (this._subscribers) {\n      this._subscribers.delete(subscriber);\n    }\n    if (this._subscribers && this._subscribers.size <= 0) {\n      if (this._bSubDisposer) {\n        const _bSubDisposer = this._bSubDisposer;\n        this._bSubDisposer = null;\n        _bSubDisposer();\n      }\n    }\n  }\n\n  public clear(): void {\n    if (this._subscribers) {\n      this._subscribers.clear();\n    }\n    if (this._bSubDisposer) {\n      const _bSubDisposer = this._bSubDisposer;\n      this._bSubDisposer = null;\n      _bSubDisposer();\n    }\n  }\n\n  public destroy(): void {\n    this.clear();\n  }\n\n  private _subscribers?: Set<ValSubscriber<TValue, TMeta>>;\n\n  private _bSub?: () => void | ValDisposer | undefined;\n  private _bSubDisposer?: ValDisposer | void | null;\n}\n","import { Subscribers } from \"./subscribers\";\nimport type { ValDisposer, ValSubscriber, ValConfig } from \"./typings\";\n\nexport class ReadonlyVal<TValue = any, TMeta = any> {\n  private _subscribers: Subscribers<TValue, TMeta>;\n\n  protected _value: TValue;\n\n  protected _setValue(value: TValue, meta?: TMeta): void {\n    if (!this.compare(value, this._value)) {\n      this._value = value;\n      this._subscribers.invoke(value, meta);\n    }\n  }\n\n  public constructor(value: TValue, config?: ValConfig<TValue, TMeta>) {\n    this._value = value;\n\n    let beforeSubscribe: undefined | (() => void | ValDisposer | undefined);\n\n    if (config) {\n      if (config.compare) {\n        this.compare = config.compare;\n      }\n      if (config.beforeSubscribe) {\n        const _beforeSubscribe = config.beforeSubscribe;\n        const _setValue = this._setValue.bind(this);\n        beforeSubscribe = () => _beforeSubscribe(_setValue);\n      }\n    }\n\n    this._subscribers = new Subscribers<TValue, TMeta>(beforeSubscribe);\n  }\n\n  public get value(): TValue {\n    return this._value;\n  }\n\n  /**\n   * Subscribe to value changes without immediate emission.\n   */\n  public reaction(subscriber: ValSubscriber<TValue, TMeta>): ValDisposer {\n    this._subscribers.add(subscriber);\n\n    return (): void => {\n      this._subscribers.remove(subscriber);\n    };\n  }\n\n  /**\n   * Subscribe to value changes with immediate emission.\n   * @param subscriber\n   * @param meta Meta for the immediate emission\n   */\n  public subscribe(\n    subscriber: ValSubscriber<TValue, TMeta>,\n    meta?: TMeta\n  ): ValDisposer {\n    const disposer = this.reaction(subscriber);\n    subscriber(this._value, meta);\n    return disposer;\n  }\n\n  public destroy(): void {\n    this._subscribers.destroy();\n  }\n\n  public unsubscribe<T extends (...args: any[]) => any>(subscriber: T): void {\n    this._subscribers.remove(subscriber);\n  }\n\n  public get size(): number {\n    return this._subscribers.size;\n  }\n\n  /**\n   * Compare two values. Default `===`.\n   */\n  public compare(newValue: TValue, oldValue: TValue): boolean {\n    return newValue === oldValue;\n  }\n}\n","import { ReadonlyVal } from \"./readonly-val\";\n\nexport class Val<TValue = any, TMeta = any> extends ReadonlyVal<TValue, TMeta> {\n  public setValue: (value: TValue, meta?: TMeta) => void = this._setValue;\n}\n","import { ReadonlyVal } from \"./readonly-val\";\nimport type { ValConfig, ValTransform } from \"./typings\";\n\nexport class DerivedVal<\n  TSrcValue = any,\n  TValue = any,\n  TMeta = any\n> extends ReadonlyVal<TValue, TMeta> {\n  public constructor(\n    val: ReadonlyVal<TSrcValue>,\n    transform: ValTransform<TSrcValue, TValue>,\n    config: ValConfig<TValue, TMeta> = {}\n  ) {\n    super(transform(val.value), {\n      ...config,\n      beforeSubscribe: setValue => {\n        const disposer = val.subscribe((newValue, meta) =>\n          setValue(transform(newValue), meta)\n        );\n        if (config.beforeSubscribe) {\n          const beforeSubscribeDisposer = config.beforeSubscribe(setValue);\n          if (beforeSubscribeDisposer) {\n            return () => {\n              disposer();\n              beforeSubscribeDisposer();\n            };\n          }\n        }\n        return disposer;\n      },\n    });\n\n    this._srcValue = () => transform(val.value);\n  }\n\n  public override get value(): TValue {\n    if (this.size <= 0) {\n      const value = this._srcValue();\n      return this.compare(value, this._value) ? this._value : value;\n    }\n    return this._value;\n  }\n\n  private _srcValue: () => TValue;\n}\n\nexport function derive<TSrcValue = any, TValue = any, TMeta = any>(\n  val: ReadonlyVal<TSrcValue>\n): ReadonlyVal<TValue, TMeta>;\nexport function derive<TSrcValue = any, TValue = any, TMeta = any>(\n  val: ReadonlyVal<TSrcValue>,\n  transform: ValTransform<TSrcValue, TValue>,\n  config?: ValConfig<TValue, TMeta>\n): ReadonlyVal<TValue, TMeta>;\nexport function derive<TSrcValue = any, TValue = any, TMeta = any>(\n  val: ReadonlyVal<TSrcValue>,\n  transform: ValTransform<TSrcValue, TValue> = value =>\n    value as unknown as TValue,\n  config: ValConfig<TValue, TMeta> = {}\n): ReadonlyVal<TValue, TMeta> {\n  return new DerivedVal(val, transform, config);\n}\n","import { ReadonlyVal } from \"./readonly-val\";\nimport type { ValConfig } from \"./typings\";\n\nexport type TValInputsValueTuple<TValInputs extends readonly ReadonlyVal[]> =\n  Readonly<{\n    [K in keyof TValInputs]: ExtractValValue<TValInputs[K]>;\n  }>;\n\nexport type ExtractValValue<TVal> = TVal extends ReadonlyVal<infer TValue, any>\n  ? TValue\n  : never;\n\nexport type ExtractValMeta<TVal> = TVal extends ReadonlyVal<any, infer TMeta>\n  ? TMeta\n  : never;\n\nexport type CombineValTransform<\n  TDerivedValue = any,\n  TValues extends readonly any[] = any[],\n  TMeta = any\n> = (newValues: TValues, oldValues?: TValues, meta?: TMeta) => TDerivedValue;\n\nexport class CombinedVal<\n  TValInputs extends readonly ReadonlyVal[] = ReadonlyVal[],\n  TValue = any,\n  TMeta = ExtractValMeta<TValInputs[number]>\n> extends ReadonlyVal<TValue, TMeta> {\n  public constructor(\n    valInputs: TValInputs,\n    transform: CombineValTransform<\n      TValue,\n      [...TValInputsValueTuple<TValInputs>],\n      TMeta\n    >,\n    config: ValConfig<TValue, TMeta> = {}\n  ) {\n    super(transform(getValues(valInputs)), {\n      ...config,\n      beforeSubscribe: setValue => {\n        let lastValueInputs = getValues(valInputs);\n        setValue(transform(lastValueInputs));\n        const disposers = valInputs.map((val, i) =>\n          val.reaction((value, meta) => {\n            lastValueInputs = lastValueInputs.slice() as [\n              ...TValInputsValueTuple<TValInputs>\n            ];\n            lastValueInputs[i] = value;\n            setValue(transform(lastValueInputs), meta);\n          })\n        );\n        const disposer = () => disposers.forEach(disposer => disposer());\n\n        if (config.beforeSubscribe) {\n          const beforeSubscribeDisposer = config.beforeSubscribe(setValue);\n          if (beforeSubscribeDisposer) {\n            return () => {\n              disposer();\n              beforeSubscribeDisposer();\n            };\n          }\n        }\n\n        return disposer;\n      },\n    });\n\n    this._srcValue = () => transform(getValues(valInputs));\n  }\n\n  public override get value(): TValue {\n    if (this.size <= 0) {\n      const value = this._srcValue();\n      return this.compare(value, this._value) ? this._value : value;\n    }\n    return this._value;\n  }\n\n  private _srcValue: () => TValue;\n}\n\nfunction getValues<TValInputs extends readonly ReadonlyVal[]>(\n  valInputs: TValInputs\n): [...TValInputsValueTuple<TValInputs>] {\n  return valInputs.map(getValue) as [...TValInputsValueTuple<TValInputs>];\n}\n\nfunction getValue<TValue>(val: ReadonlyVal<TValue>): TValue {\n  return val.value;\n}\n\nexport function combine<\n  TValInputs extends readonly ReadonlyVal[] = ReadonlyVal[]\n>(\n  valInputs: readonly [...TValInputs]\n): ReadonlyVal<\n  [...TValInputsValueTuple<TValInputs>],\n  ExtractValMeta<TValInputs[number]>\n>;\nexport function combine<\n  TValInputs extends readonly ReadonlyVal[] = ReadonlyVal[],\n  TValue = any,\n  TMeta = ExtractValMeta<TValInputs[number]>\n>(\n  valInputs: readonly [...TValInputs],\n  transform: CombineValTransform<\n    TValue,\n    [...TValInputsValueTuple<TValInputs>],\n    TMeta\n  >,\n  config?: ValConfig<TValue, TMeta>\n): ReadonlyVal<TValue, TMeta>;\nexport function combine<\n  TValInputs extends readonly ReadonlyVal[] = ReadonlyVal[],\n  TValue = any,\n  TMeta = ExtractValMeta<TValInputs[number]>\n>(\n  valInputs: readonly [...TValInputs],\n  transform: CombineValTransform<\n    TValue,\n    [...TValInputsValueTuple<TValInputs>],\n    TMeta\n  > = value => value as TValue,\n  config: ValConfig<TValue, TMeta> = {}\n): ReadonlyVal<TValue, TMeta> {\n  return new CombinedVal(valInputs, transform, config);\n}\n","import type { ReadonlyVal } from \"./readonly-val\";\nimport type { ValDisposer, ValSubscriber } from \"./typings\";\n\ntype ValueFromVal<V> = V extends ReadonlyVal<infer TValue> ? TValue : never;\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ntype MetaFromVal<V> = V extends ReadonlyVal<infer _TValue, infer TMeta>\n  ? TMeta\n  : never;\n\nexport type WithOnValChanged<TConfig, TEnhancedResult> = TEnhancedResult & {\n  onValChanged: <\n    K extends Extract<keyof TConfig, string> = Extract<keyof TConfig, string>\n  >(\n    key: K,\n    listener: ValSubscriber<\n      ValueFromVal<TEnhancedResult[Extract<`_${K}$`, keyof TEnhancedResult>]>,\n      MetaFromVal<TEnhancedResult[Extract<`_${K}$`, keyof TEnhancedResult>]>\n    >\n  ) => ValDisposer;\n};\n\nexport function withOnValChanged<TInstance>(instance: TInstance): void {\n  if (!(instance as any).onValChanged) {\n    (instance as any).onValChanged = onValChanged;\n  }\n}\n\nfunction onValChanged<TConfig, K extends Extract<keyof TConfig, string>, O>(\n  this: O,\n  key: K,\n  listener: ValSubscriber<\n    ValueFromVal<O[Extract<`_${K}$`, keyof O>]>,\n    MetaFromVal<O[Extract<`_${K}$`, keyof O>]>\n  >\n): ValDisposer {\n  const val = (this as any)[`_${key}$`] || (this as any)[key];\n  if (!val?.reaction) {\n    throw new TypeError(`\"${key}\" is not related to a Val in this instance`);\n  }\n  return val.reaction(listener);\n}\n","/* eslint-disable @typescript-eslint/ban-types */\n\nimport type { ExtractValValue } from \"./combine\";\nimport type { ReadonlyVal } from \"./readonly-val\";\nimport type { ValManager } from \"./val-manager\";\nimport type { WithOnValChanged } from \"./with-on-val-changed\";\nimport { withOnValChanged } from \"./with-on-val-changed\";\n\ntype IntersectionFromUnion<TUnion> = (\n  TUnion extends any ? (arg: TUnion) => void : never\n) extends (arg: infer TArg) => void\n  ? TArg\n  : never;\n\ntype ExtractReadonlyValKeys<\n  TInstance,\n  TKey = keyof TInstance\n> = TKey extends Extract<keyof TInstance, string>\n  ? TInstance[TKey] extends ReadonlyVal\n    ? TKey\n    : never\n  : never;\n\nexport type ReadonlyValEnhancedProps<TVal, TKey extends string> = Readonly<\n  Record<TKey, ExtractValValue<TVal>> & Record<`_${TKey}$`, TVal>\n>;\n\nexport type ReadonlyValEnhancerConfig = Record<string, ReadonlyVal>;\n\ntype ToReadonlyValUnion<\n  TConfig,\n  TKey = ExtractReadonlyValKeys<TConfig>\n> = TKey extends ExtractReadonlyValKeys<TConfig>\n  ? ReadonlyValEnhancedProps<TConfig[TKey], TKey>\n  : never;\n\nexport type ReadonlyValEnhancedResult<TConfig> = WithOnValChanged<\n  TConfig,\n  IntersectionFromUnion<ToReadonlyValUnion<TConfig>>\n>;\n\n/**\n * Bind ReadonlyVals/Vals `value` and itself to properties of an instance.\n *\n * @example\n * ```ts\n * import type { ReadonlyValEnhancedResult } from \"value-enhancer\";\n * import { Val, withReadonlyValueEnhancer } from \"value-enhancer\";\n *\n * type ReadonlyValConfig = {\n *   apple: Val<string>\n *   isApple: ReadonlyVal<boolean>\n * };\n *\n * interface Obj extends ReadonlyValEnhancedResult<ReadonlyValConfig> {}\n *\n * class Obj {\n *   constructor() {\n *     const apple$ = new Val(\"apple\");\n *     const isApple$ = derive(apple$, (apple) => apple === \"apple\");\n *\n *     withReadonlyValueEnhancer(this, {\n *       apple: apple$,\n *       isApple: isApple$,\n *     })\n *   }\n * }\n * ```\n *\n * `const obj = new Obj()` results in:\n * - `obj.apple`, a getter that returns `apple$.value`\n * - `obj._apple$`, the `apple$`\n * - `obj.isApple`, a getter that returns `isApple$.value`\n * - `obj._isApple$`, the `isApple$`\n * - `obj.onValChanged(key: \"apple\" | \"isApple\", listener)`, equals to calling <code>obj[\\`_${key}$\\`].reaction</code>\n */\nexport function withReadonlyValueEnhancer<\n  TInstance extends ReadonlyValEnhancedResult<TConfig>,\n  TConfig extends ReadonlyValEnhancerConfig\n>(instance: TInstance, config: TConfig, valManager?: ValManager): void {\n  Object.keys(config).forEach(key => {\n    bindInstance(instance, key, config[key]);\n    if (valManager) {\n      valManager.attach(config[key]);\n    }\n  });\n  withOnValChanged(instance);\n}\n\n/**\n * Bind a ReadonlyVal/Val to a property of an instance.\n *\n * @example\n * `bindInstance(Obj, \"aKey\", val)` results in:\n * - `Obj.aKey`, value of `val.value`\n * - `Obj._aKey$`, the `val`\n * @returns Same instance with bound properties\n */\nfunction bindInstance<TInstance, TKey extends string, TValue, TMeta>(\n  instance: TInstance,\n  key: TKey,\n  val: ReadonlyVal<TValue, TMeta>\n): ReadonlyValEnhancedProps<TValue, TKey> & TInstance {\n  Object.defineProperties(instance, {\n    [key]: {\n      get() {\n        return val.value;\n      },\n    },\n    [`_${key}$`]: {\n      value: val,\n    },\n  });\n  return instance as ReadonlyValEnhancedProps<TValue, TKey> & TInstance;\n}\n","/* eslint-disable @typescript-eslint/ban-types */\n\nimport type { ExtractValMeta, ExtractValValue } from \"./combine\";\nimport type { Val } from \"./val\";\nimport type { ValManager } from \"./val-manager\";\nimport type { WithOnValChanged } from \"./with-on-val-changed\";\nimport { withOnValChanged } from \"./with-on-val-changed\";\n\ntype IntersectionFromUnion<TUnion> = (\n  TUnion extends any ? (arg: TUnion) => void : never\n) extends (arg: infer TArg) => void\n  ? TArg\n  : never;\n\ntype ExtractValKeys<TInstance, TKey = keyof TInstance> = TKey extends Extract<\n  keyof TInstance,\n  string\n>\n  ? TInstance[TKey] extends Val\n    ? TKey\n    : never\n  : never;\n\ntype ValEnhancedProps<TVal, TKey extends string> = Readonly<\n  Record<`_${TKey}$`, TVal> &\n    Record<\n      `set${Capitalize<TKey>}`,\n      (value: ExtractValValue<TVal>, meta?: ExtractValMeta<TVal>) => void\n    >\n> &\n  Record<TKey, ExtractValValue<TVal>>;\n\nexport type ValEnhancerConfig = Record<string, Val>;\n\ntype ToValUnion<\n  TConfig,\n  TKey = ExtractValKeys<TConfig>\n> = TKey extends ExtractValKeys<TConfig>\n  ? ValEnhancedProps<TConfig[TKey], TKey>\n  : never;\n\nexport type ValEnhancedResult<TConfig> = WithOnValChanged<\n  TConfig,\n  IntersectionFromUnion<ToValUnion<TConfig>>\n>;\n\n/**\n * Bind Vals `value`, `setValue` and itself to properties of an instance.\n *\n * @example\n * ```ts\n * import type { ValEnhancedResult } from \"value-enhancer\";\n * import { Val, withValueEnhancer } from \"value-enhancer\";\n *\n * type ValConfig = {\n *   apple: Val<string>\n *   banana: Val<string>\n * };\n *\n * interface Obj extends ValEnhancedResult<ValConfig> {}\n *\n * class Obj {\n *   constructor() {\n *     const apple$ = new Val(\"apple\");\n *     const banana$ = new Val(\"banana\");\n *\n *     withValueEnhancer(this, {\n *       apple: apple$,\n *       banana: banana$,\n *     })\n *   }\n * }\n * ```\n *\n * `const obj = new Obj()` results in:\n * - `obj.apple`, a getter that returns `apple$.value`, setter same as `apple$.setValue(value)`\n * - `obj._apple$`, the `apple$`\n * - `obj.setApple(value)`, same as `apple$.setValue(value)`\n * - `obj.banana`, a getter that returns `banana$.value`, setter same as `banana$.setValue(value)`\n * - `obj.setBanana(value)`, same as `banana$.setValue(value)`\n * - `obj._banana$`, the `banana$`\n * - `obj.onValChanged(key: \"apple\" | \"isApple\", listener)`, equals to calling <code>obj[\\`_${key}$\\`].reaction</code>\n */\nexport function withValueEnhancer<\n  TInstance extends ValEnhancedResult<TConfig>,\n  TConfig extends ValEnhancerConfig\n>(instance: TInstance, config: TConfig, valManager?: ValManager): void {\n  Object.keys(config).forEach(key => {\n    bindInstance(instance, key, config[key]);\n    if (valManager) {\n      valManager.attach(config[key]);\n    }\n  });\n  withOnValChanged(instance);\n}\n\nexport type BindVal = <TKey extends string, TValue, TMeta>(\n  key: TKey,\n  val: Val<TValue, TMeta>\n) => Val<TValue, TMeta>;\n\n/**\n * Bind a Val to a property of an instance.\n *\n * @example\n * `bindInstance(obj, \"aKey\", val)` results in:\n * - `obj.aKey`, getter that returns `val.value`, setter same as `val.setValue(value)`\n * - `obj.setAKey(value)`, same as `val.setValue(value)`\n * - `obj._aKey$`, the `val`\n * @returns Same instance with bound properties\n */\nexport function bindInstance<TInstance, TKey extends string, TValue, TMeta>(\n  instance: TInstance,\n  key: TKey,\n  val: Val<TValue, TMeta>\n): ValEnhancedProps<TValue, TKey> & TInstance {\n  Object.defineProperties(instance, {\n    [key]: {\n      get() {\n        return val.value;\n      },\n      set(value) {\n        val.setValue(value);\n      },\n    },\n    [`_${key}$`]: {\n      value: val,\n    },\n    [`set${capitalize(key)}`]: {\n      value: (value: TValue, meta?: TMeta): void => val.setValue(value, meta),\n    },\n  });\n  return instance as ValEnhancedProps<TValue, TKey> & TInstance;\n}\n\nfunction capitalize<TStr extends string>(str: TStr): Capitalize<TStr> {\n  return (str[0].toUpperCase() + str.slice(1)) as Capitalize<TStr>;\n}\n","import type { ReadonlyVal } from \"./readonly-val\";\n\n/**\n * Manage life-cycles of a list of Vals (e.g. auto cleanup).\n *\n * @example\n * ```ts\n * const valManager = new ValManager();\n * const val1 = valManager.attach(new Val(\"12345\"));\n * const val2 = valManager.attach(new Val(\"\"));\n *\n * valManager.destroy(); // val1.destroy() and val2.destroy() are called\n * ```\n */\nexport class ValManager {\n  public readonly vals = new Set<ReadonlyVal>();\n\n  /** Attach a val to manager */\n  public attach<V extends ReadonlyVal>(val: V): V {\n    this.vals.add(val);\n    return val;\n  }\n\n  /** Detach a val from manager */\n  public detach<V extends ReadonlyVal>(val: V): V {\n    this.vals.delete(val);\n    return val;\n  }\n\n  public destroy(): void {\n    this.vals.forEach(destroyVal);\n    this.vals.clear();\n  }\n}\n\nfunction destroyVal(val: ReadonlyVal): void {\n  val.destroy();\n}\n"],"names":["bindInstance"],"mappings":"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"}